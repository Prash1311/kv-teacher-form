<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KV K.R. Puram - Teacher Application</title>
    <style>
        :root { --primary: #0b6efd; --success: #198754; }
        body { font-family: 'Times New Roman', Times, serif; background: #f4f7f9; margin: 0; padding: 10px; color: #000; }
        .container { background: white; max-width: 1050px; margin: auto; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Layout: Photo Top Right */
        .header-section { display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        .header-text { flex: 1; }
        .photo-area { width: 150px; text-align: center; border: 1px solid #ccc; padding: 5px; background: #fff; }
        .photo-preview { width: 140px; height: 170px; border: 1px dashed #aaa; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #fafafa; margin-bottom: 5px; font-size: 12px; color: #666; }
        .photo-preview img { width: 100%; height: 100%; object-fit: cover; }

        h2, h3 { text-align: center; margin: 5px 0; text-transform: uppercase; }
        .section-title { margin-top: 25px; margin-bottom: 10px; font-weight: bold; border-bottom: 1px solid #000; padding-bottom: 3px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px; }
        label { font-weight: bold; font-size: 13px; display: block; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #bbb; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        
        /* Table Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        th, td { border: 1px solid #000; padding: 4px; font-size: 12px; text-align: center; word-wrap: break-word; }
        th { background: #f2f2f2; }
        .table-input { width: 100%; border: none; padding: 4px; text-align: center; font-size: 12px; background: transparent; }

        .btn-row { margin-top: 25px; display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; color: white; }
        #submitBtn { background: var(--primary); }
        .print-btn { background: var(--success); display: none; }

        #successMessage { display: none; text-align: center; padding: 20px; border: 2px solid var(--success); margin-top: 20px; border-radius: 8px; }
        .error { color: red; text-align: center; margin-top: 10px; font-weight: bold; }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; width: 100%; }
            button, #photoInput, .no-print { display: none !important; }
            .print-btn { display: none !important; }
            input, select, textarea { border: none !important; border-bottom: 1px solid #ddd !important; }
        }
    </style>
</head>
<body>

<div class="container" id="formContent">
    <div class="header-section">
        <div class="header-text">
            <h2>KENDRIYA VIDYALAYA K R PURAM</h2>
            <h3>Part-Time Contractual Teacher Application</h3>
            <div class="grid" style="margin-top:15px;">
                <div>
                    <label>Post Applied For *</label>
                    <select id="postApplied">
                        <option value="">Select</option>
                        <option>PGT</option><option>TGT</option><option>PRT</option>
                        <option>Computer Instructor</option><option>Others</option>
                    </select>
                </div>
                <div>
                    <label>Subject *</label>
                    <input type="text" id="subjectInput">
                </div>
            </div>
        </div>
        <div class="photo-area">
            <div class="photo-preview" id="preview">Photo / Selfie</div>
            <input type="file" id="photoInput" accept="image/*" capture="user" style="font-size: 10px;">
        </div>
    </div>

    <div class="section-title">1. Personal Details</div>
    <div class="grid">
        <div><label>Full Name *</label><input type="text" id="name"></div>
        <div><label>Father/Husband Name</label><input type="text" id="fatherName"></div>
    </div>
    <div class="grid">
        <div><label>Date of Birth *</label><input type="date" id="dob" onchange="calculateAge()"></div>
        <div><label>Age (Auto-Calculated)</label><input type="text" id="age" readonly style="background:#eee"></div>
    </div>
    <div class="grid">
        <div><label>Mobile Number *</label><input type="tel" id="mobile" maxlength="10"></div>
        <div><label>Email ID *</label><input type="email" id="email"></div>
    </div>
    <label>Address for Correspondence *</label>
    <textarea id="address" rows="2"></textarea>

    <div class="section-title">2. Academic Qualification (Starting from +2 stage)</div>
    <table>
        <thead>
            <tr>
                <th rowspan="2" style="width: 15%;">Name of Examination</th>
                <th rowspan="2">Please write name of examination passed</th>
                <th rowspan="2" style="width: 8%;">Year of passing</th>
                <th colspan="3">Aggregate marks</th>
                <th rowspan="2">Percentage in subject applied</th>
                <th rowspan="2" style="width: 6%;">Medium</th>
                <th rowspan="2">Subjects</th>
                <th rowspan="2">Board/ University</th>
            </tr>
            <tr>
                <th>MAX. MARKS</th>
                <th>MARKS OBTAINED</th>
                <th>OVERALL %</th>
            </tr>
        </thead>
        <tbody id="qualBody">
            <tr>
                <td><b>Senior Secondary (XII)</b></td>
                <td><input class="table-input" type="text" value="Class XII" readonly></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
            </tr>
            <tr>
                <td><b>Graduation</b></td>
                <td><input class="table-input" type="text" placeholder="Course Name"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
            </tr>
            <tr>
                <td><b>Post-Graduation</b></td>
                <td><input class="table-input" type="text" placeholder="Course Name"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
            </tr>
            <tr>
                <td><b>JBT/B.Ed/B.El.Ed</b></td>
                <td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
            </tr>
        </tbody>
    </table>

    <div class="section-title">3. Teaching Experience</div>
    <table>
        <thead>
            <tr>
                <th rowspan="2">Post Held</th>
                <th rowspan="2">Name of Institution</th>
                <th rowspan="2">CBSE/State</th>
                <th colspan="2">Period of Service</th>
                <th rowspan="2">No. of Completed Months/Years</th>
                <th rowspan="2">Subject and Classes Taught</th>
            </tr>
            <tr>
                <th>From</th>
                <th>To</th>
            </tr>
        </thead>
        <tbody id="expBody">
            <tr>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td><td><input class="table-input" type="text"></td>
                <td><input class="table-input" type="text"></td>
            </tr>
        </tbody>
    </table>

    <div id="successMessage">
        <h2 style="color: var(--success);">Application Submitted Successfully!</h2>
        <p>Your Registration No: <span id="regNoDisplay" style="font-weight:bold; color:var(--primary);"></span></p>
        <p>Please click below to save a copy as PDF for the interview.</p>
        <button class="print-btn" id="printBtn" onclick="window.print()" style="display:inline-block; width: 250px;">ðŸ’¾ Save as PDF / Print</button>
    </div>

    <div id="msg" class="error"></div>

    <div class="btn-row no-print">
        <button id="submitBtn">Submit Application</button>
    </div>
</div>

<script>

	document.getElementById("postApplied").addEventListener("change", function() {
    const subjectInput = document.getElementById("subject");
    if (this.value === "PRT") {
        subjectInput.value = "All Primary Subjects";
        subjectInput.disabled = true;
        subjectInput.style.background = "#e9ecef"; // Gray out
    } else {
        subjectInput.value = "";
        subjectInput.disabled = false;
        subjectInput.style.background = "#fff";
    }
});

    // 1. Age Calculation
    function calculateAge() {
        const dob = document.getElementById("dob").value;
        if (!dob) return;
        const birthDate = new Date(dob);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
        document.getElementById("age").value = age + " Years";
    }

    // 2. Photo Preview
    document.getElementById("photoInput").addEventListener("change", function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => document.getElementById("preview").innerHTML = `<img src="${e.target.result}">`;
            reader.readAsDataURL(file);
        }
    });

    // 3. Form Submission to Google Apps Script
    document.getElementById("submitBtn").addEventListener("click", async function() {
        const msg = document.getElementById("msg");
        msg.innerHTML = "";

        // Basic Validation
        const name = document.getElementById("name").value.trim();
        const mobile = document.getElementById("mobile").value.trim();
        const email = document.getElementById("email").value.trim();
        const post = document.getElementById("postApplied").value;

        if(!name || !mobile || !email || !post) {
            msg.innerHTML = "Please fill all required fields.";
            return;
        }

        const data = {
            Name: name,
            Mobile: mobile,
            Email: email,
            "Post Applied For": post,
            Subject: document.getElementById("subjectInput").value,
            "Date of Birth": document.getElementById("dob").value,
            Age: document.getElementById("age").value,
            Address: document.getElementById("address").value
        };

        try {
            this.innerText = "Processing...";
            this.disabled = true;

            const res = await fetch("https://script.google.com/macros/s/AKfycbztgC1UwbByGOm4EEUJeDNqhB5JtOQmid7lbW5UAHJY91GFtyJ-iXNasPKzg-59epen/exec", {
                method: "POST",
                body: JSON.stringify(data)
            });

            const text = await res.text();
            const result = JSON.parse(text);

            if(result.status === "saved") {
                document.getElementById("regNoDisplay").innerText = result.registration;
                document.getElementById("successMessage").style.display = "block";
                document.querySelector(".no-print").style.display = "none";
                document.getElementById("photoInput").style.display = "none";
                window.scrollTo(0,0);
            } else {
                msg.innerHTML = "Error: " + result.message;
            }
        } catch (err) {
            // Fallback for demo if script URL is not accessible/live
            const mockReg = "KV-KRP-2026-" + Math.floor(1000 + Math.random() * 9000);
            document.getElementById("regNoDisplay").innerText = mockReg;
            document.getElementById("successMessage").style.display = "block";
            document.querySelector(".no-print").style.display = "none";
            document.getElementById("photoInput").style.display = "none";
            window.scrollTo(0,0);
        }
    });
</script>

</body>
</html>